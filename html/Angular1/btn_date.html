<!DOCTYPE html>
<html>
   <head>
      <meta charset='utf-8'>
      <meta http-equiv="X-UA-Compatible" content="chrome=1">
      <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
      <meta name="description" content="directive">
      <meta name="keywords" content="吴杨杨,个人博客,directive封装mui时间控件,angular1,tgwuyangyang.github.io">
      <!--<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">-->
      <LINK href="../../images/wu.ico" type="img/x-icon" rel=icon>
      <link rel="stylesheet" type="text/css" href="../../css/stylesheet.css" media="screen">
      <link rel="stylesheet" type="text/css" href="../../css/html/content.css">
      <title>吴杨杨的个人博客</title>
   </head>

   <body>
      <div id="container">
         <div class="inner">
            <header>
               <h1>Tgwuyangyang.GitHub.com</h1>
            </header>
            <hr>
            <p class="title"><span>directive封装mui时间控件</span></p>
            <hr>
            <section id="main_content">
               <p class="author">
                  <span>作者：吴杨杨</span>
                  <a class="back" href="../../index.html">返回首页</a>
               </p>
               <p class="time"><span>时间：2016-12-07</span></p>
               <p>最近，在angularjs框架中需要使用到时间控件，用的地方比较多，所以用directive指令封装了一个mui的时间控件。代码如下：</p>
               <pre><code>angular.module('app')
   .directive('btnDate', function() {
      return {
         restrict: 'A',
         require: "ngModel",
         link: function(scope, elem, attrs, ngModelCtr) {
            var dom = elem.get(0);
            dom.addEventListener('tap', function() {
               var optionsJson = dom.getAttribute('data-options') || '{}';
               var options = JSON.parse(optionsJson);
               var id = dom.getAttribute('id');
               angular.element('input').blur();
               var picker = new mui.DtPicker(options);
               picker.show(function(rs) {
                  var time = rs.text;
                  elem.val(time);
                  refresh();
                  picker.dispose();
               });
            }, false);
            
            elem.on('blur keyup change', function() {
               scope.$apply(refresh);
            });
            
            refresh();
            
            function refresh() {
               var time = elem.val();
               ngModelCtr.$setViewValue(time);
            }
         }
      };
   });
               </code></pre>
               <p>html代码：</p>
               <pre><code>&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#34;&#32;&#100;&#97;&#116;&#97;&#45;&#111;&#112;&#116;&#105;&#111;&#110;&#115;&#61;&#39;&#123;&#125;&#39;&#32;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#61;&#34;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#34;&#32;&#98;&#116;&#110;&#45;&#100;&#97;&#116;&#101;&#32;&#112;&#108;&#97;&#99;&#101;&#104;&#111;&#108;&#100;&#101;&#114;&#61;&#34;&#38;&#35;&#120;&#56;&#66;&#70;&#55;&#59;&#38;&#35;&#120;&#57;&#48;&#48;&#57;&#59;&#38;&#35;&#120;&#54;&#50;&#69;&#57;&#59;&#34;&#32;&#110;&#103;&#45;&#109;&#111;&#100;&#101;&#108;&#61;&#34;&#101;&#110;&#100;&#68;&#97;&#116;&#101;&#34;&#32;&#47;&#62;
               </code></pre>
               <p>效果如下：</p>
               <img src="../../images/btn-date-timestamp.png" />
               <p>年月日</p>
               <pre><code>&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#34;&#32;&#100;&#97;&#116;&#97;&#45;&#111;&#112;&#116;&#105;&#111;&#110;&#115;&#61;&#39;&#123;&#34;&#116;&#121;&#112;&#101;&#34;&#58;&#34;&#100;&#97;&#116;&#101;&#34;&#125;&#39;&#32;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#61;&#34;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#34;&#32;&#98;&#116;&#110;&#45;&#100;&#97;&#116;&#101;&#32;&#112;&#108;&#97;&#99;&#101;&#104;&#111;&#108;&#100;&#101;&#114;&#61;&#34;&#38;&#35;&#120;&#56;&#66;&#70;&#55;&#59;&#38;&#35;&#120;&#57;&#48;&#48;&#57;&#59;&#38;&#35;&#120;&#54;&#50;&#69;&#57;&#59;&#34;&#32;&#110;&#103;&#45;&#109;&#111;&#100;&#101;&#108;&#61;&#34;&#101;&#110;&#100;&#68;&#97;&#116;&#101;&#34;&#32;&#47;&#62;
               </code></pre>
               <p>效果如下：</p>
               <img src="../../images/btn-date-date.png" />
               <p>年月</p>
               <pre><code>&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#34;&#32;&#100;&#97;&#116;&#97;&#45;&#111;&#112;&#116;&#105;&#111;&#110;&#115;&#61;&#39;&#34;&#116;&#121;&#112;&#101;&#34;&#58;&#34;&#109;&#111;&#110;&#116;&#104;&#34;&#39;&#32;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#61;&#34;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#34;&#32;&#98;&#116;&#110;&#45;&#100;&#97;&#116;&#101;&#32;&#112;&#108;&#97;&#99;&#101;&#104;&#111;&#108;&#100;&#101;&#114;&#61;&#34;&#38;&#35;&#120;&#56;&#66;&#70;&#55;&#59;&#38;&#35;&#120;&#57;&#48;&#48;&#57;&#59;&#38;&#35;&#120;&#54;&#50;&#69;&#57;&#59;&#34;&#32;&#110;&#103;&#45;&#109;&#111;&#100;&#101;&#108;&#61;&#34;&#101;&#110;&#100;&#68;&#97;&#116;&#101;&#34;&#32;&#47;&#62;
               </code></pre>
               <p>效果如下：</p>
               <img src="../../images/btn-date-month.png" />
               <p>时分</p>
               <pre><code>&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#34;&#32;&#100;&#97;&#116;&#97;&#45;&#111;&#112;&#116;&#105;&#111;&#110;&#115;&#61;&#39;&#34;&#116;&#121;&#112;&#101;&#34;&#58;&#34;&#116;&#105;&#109;&#101;&#34;&#39;&#32;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#61;&#34;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#34;&#32;&#98;&#116;&#110;&#45;&#100;&#97;&#116;&#101;&#32;&#112;&#108;&#97;&#99;&#101;&#104;&#111;&#108;&#100;&#101;&#114;&#61;&#34;&#38;&#35;&#120;&#56;&#66;&#70;&#55;&#59;&#38;&#35;&#120;&#57;&#48;&#48;&#57;&#59;&#38;&#35;&#120;&#54;&#50;&#69;&#57;&#59;&#34;&#32;&#110;&#103;&#45;&#109;&#111;&#100;&#101;&#108;&#61;&#34;&#101;&#110;&#100;&#68;&#97;&#116;&#101;&#34;&#32;&#47;&#62;
               </code></pre>
               <p>效果如下：</p>
               <img src="../../images/btn-date-time.png" />
               <p>时段</p>
               <pre><code>&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#34;&#32;&#100;&#97;&#116;&#97;&#45;&#111;&#112;&#116;&#105;&#111;&#110;&#115;&#61;&#39;&#123;&#34;&#116;&#121;&#112;&#101;&#34;&#58;&#34;&#104;&#111;&#117;&#114;&#34;&#44;&#34;&#99;&#117;&#115;&#116;&#111;&#109;&#68;&#97;&#116;&#97;&#34;&#58;&#123;&#34;&#104;&#34;&#58;&#91;&#123;&#34;&#116;&#101;&#120;&#116;&#34;&#58;&#34;&#19978;&#21320;&#34;&#44;&#34;&#118;&#97;&#108;&#117;&#101;&#34;&#58;&#34;&#19978;&#21320;&#34;&#125;&#44;&#123;&#34;&#116;&#101;&#120;&#116;&#34;&#58;&#34;&#19979;&#21320;&#34;&#44;&#34;&#118;&#97;&#108;&#117;&#101;&#34;&#58;&#34;&#19979;&#21320;&#34;&#125;&#44;&#123;&#34;&#116;&#101;&#120;&#116;&#34;&#58;&#34;&#26202;&#19978;&#34;&#44;&#34;&#118;&#97;&#108;&#117;&#101;&#34;&#58;&#34;&#26202;&#19978;&#34;&#125;&#93;&#125;&#44;&#34;&#108;&#97;&#98;&#101;&#108;&#115;&#34;&#58;&#91;&#34;&#24180;&#34;&#44;&#32;&#34;&#26376;&#34;&#44;&#32;&#34;&#26085;&#34;&#44;&#32;&#34;&#26102;&#27573;&#34;&#44;&#32;&#34;&#20998;&#34;&#93;&#125;&#39;&#32;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#61;&#34;&#114;&#101;&#97;&#100;&#111;&#110;&#108;&#121;&#34;&#32;&#98;&#116;&#110;&#45;&#100;&#97;&#116;&#101;&#32;&#112;&#108;&#97;&#99;&#101;&#104;&#111;&#108;&#100;&#101;&#114;&#61;&#34;&#38;&#35;&#120;&#56;&#66;&#70;&#55;&#59;&#38;&#35;&#120;&#57;&#48;&#48;&#57;&#59;&#38;&#35;&#120;&#54;&#50;&#69;&#57;&#59;&#34;&#32;&#110;&#103;&#45;&#109;&#111;&#100;&#101;&#108;&#61;&#34;&#101;&#110;&#100;&#68;&#97;&#116;&#101;&#34;&#32;&#47;&#62;
               </code></pre>
               <p>效果如下：</p>
               <img src="../../images/btn-date-time-frame.png" />
               <p>以上html都需引入mui框架：</p>
               <pre><code>&#60;&#108;&#105;&#110;&#107;&#32;&#114;&#101;&#108;&#61;&#34;&#115;&#116;&#121;&#108;&#101;&#115;&#104;&#101;&#101;&#116;&#34;&#32;&#116;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#47;&#99;&#115;&#115;&#34;&#32;&#104;&#114;&#101;&#102;&#61;&#34;&#46;&#46;&#47;&#99;&#115;&#115;&#47;&#109;&#117;&#105;&#46;&#112;&#105;&#99;&#107;&#101;&#114;&#46;&#109;&#105;&#110;&#46;&#99;&#115;&#115;&#34;&#32;&#47;&#62;&#10;&#60;&#115;&#99;&#114;&#105;&#112;&#116;&#32;&#115;&#114;&#99;&#61;&#34;&#46;&#46;&#47;&#106;&#115;&#47;&#109;&#117;&#105;&#46;&#109;&#105;&#110;&#46;&#106;&#115;&#34;&#62;&#60;&#47;&#115;&#99;&#114;&#105;&#112;&#116;&#62;&#10;&#60;&#115;&#99;&#114;&#105;&#112;&#116;&#32;&#115;&#114;&#99;&#61;&#34;&#46;&#46;&#47;&#106;&#115;&#47;&#109;&#117;&#105;&#46;&#112;&#105;&#99;&#107;&#101;&#114;&#46;&#109;&#105;&#110;&#46;&#106;&#115;&#34;&#62;&#60;&#47;&#115;&#99;&#114;&#105;&#112;&#116;&#62;
               </code></pre>
               <p>ios系统中，同一个页面中有input文本框和时间控件同时存在，先点击input文本框输入文本，不关闭输入法，再继续点击时间控件，此时，输入法会遮住时间控件，所以，加上如下代码：</p>
               <pre><code>angular.element('input').blur();
               </code></pre>
               <p><code>blur()</code>方法的意思是使input文本框失去焦点，当input文本框失去焦点时，输入法会自动关闭。</p>
               <p>以上。</p>
               <hr>
            </section>
            <!-- UY BEGIN -->
            <div id="uyan_frame"></div>
            <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2129966"></script>
            <!-- UY END -->
            <footer>
               <table class="border-none">
                  <tr>
                     <td class="border-none">
                        This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
                     </td>
                  </tr>
               </table>
            </footer>
         </div>
      </div>
      <script src="../../js/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
   </body>
</html>
